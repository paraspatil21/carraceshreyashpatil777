<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="Advanced 3D Racing Game by Shreyash Vaibhav Patil">
    <title>VelocityX Pro Racing</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-text-size-adjust: none;
        }

        body {
            background: linear-gradient(135deg, #0a0a0a 0%, #0f172a 50%, #1e1b4b 100%);
            color: #fff;
            font-family: 'Segoe UI', 'Arial', sans-serif;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            position: fixed;
            touch-action: manipulation;
        }

        /* Galaxy Background Effect */
        .galaxy-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(72, 219, 251, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 107, 107, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(254, 202, 87, 0.1) 0%, transparent 50%);
            z-index: -2;
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(1px 1px at 20px 30px, #eee, transparent),
                radial-gradient(1px 1px at 40px 70px, #fff, transparent),
                radial-gradient(1px 1px at 90px 40px, #fff, transparent);
            background-repeat: repeat;
            background-size: 200px 200px;
            animation: twinkle 4s infinite alternate;
            z-index: -1;
        }

        @keyframes twinkle {
            0% { opacity: 0.3; }
            100% { opacity: 0.8; }
        }

        /* Game Start Screen */
        #gameStartScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(12, 36, 97, 0.9) 0%, rgba(0, 0, 0, 0.95) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            padding: 20px;
            backdrop-filter: blur(5px);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .game-brand {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .brand-logo {
            font-size: clamp(3rem, 10vw, 5rem);
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(255, 255, 255, 0.2);
            filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.3));
        }

        .brand-title {
            font-size: clamp(2rem, 8vw, 3.5rem);
            font-weight: 800;
            letter-spacing: 2px;
            background: linear-gradient(90deg, #fff, #f8f9fa);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
            text-transform: uppercase;
            position: relative;
            word-break: break-word;
            line-height: 1.2;
        }

        .brand-title::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 200px;
            max-width: 80%;
            height: 3px;
            background: linear-gradient(90deg, transparent, #48dbfb, transparent);
        }

        .brand-subtitle {
            font-size: clamp(0.9rem, 3vw, 1.2rem);
            color: #94a3b8;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .creator-badge {
            background: linear-gradient(90deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.8));
            padding: 10px 20px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(100, 116, 139, 0.3);
            backdrop-filter: blur(10px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .creator-badge span {
            background: linear-gradient(90deg, #feca57, #ff9ff3);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 600;
            font-size: clamp(0.9rem, 3vw, 1.1rem);
        }

        .game-description {
            max-width: 600px;
            margin-bottom: 30px;
            line-height: 1.6;
            color: #cbd5e1;
            font-size: clamp(0.9rem, 3vw, 1.1rem);
            padding: 0 15px;
        }

        .game-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            max-width: 500px;
            width: 90%;
        }

        .feature {
            background: rgba(30, 41, 59, 0.5);
            padding: 15px;
            border-radius: 12px;
            border: 1px solid rgba(100, 116, 139, 0.2);
            backdrop-filter: blur(5px);
        }

        .feature i {
            font-size: 1.5rem;
            margin-bottom: 8px;
            background: linear-gradient(90deg, #48dbfb, #0ea5e9);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .feature h4 {
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .feature p {
            font-size: 0.8rem;
            color: #94a3b8;
        }

        .gameButton {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border: none;
            padding: clamp(12px, 4vw, 18px) clamp(30px, 8vw, 50px);
            font-size: clamp(1rem, 4vw, 1.3rem);
            border-radius: 50px;
            color: white;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
            font-weight: 600;
            letter-spacing: 1px;
            text-transform: uppercase;
            position: relative;
            overflow: hidden;
            min-width: 200px;
            max-width: 90%;
            touch-action: manipulation;
        }

        .gameButton::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .gameButton:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(59, 130, 246, 0.6);
        }

        .gameButton:active {
            transform: translateY(2px);
        }

        /* Game Canvas with 3D effect */
        .game-container {
            position: relative;
            perspective: 1000px;
            display: none;
            width: 100%;
            max-width: 900px;
            height: 100%;
            max-height: 800px;
            margin: 0 auto;
        }

        #gameCanvas {
            background: 
                linear-gradient(to bottom, #0f172a 0%, #1e293b 30%, #334155 100%);
            display: block;
            border-radius: 15px;
            box-shadow: 
                0 20px 50px rgba(0, 0, 0, 0.8),
                0 0 0 1px rgba(59, 130, 246, 0.2);
            border: 1px solid #475569;
            transform-style: preserve-3d;
            width: 100%;
            height: 100%;
            position: relative;
            overflow: hidden;
            touch-action: none;
        }

        /* Game HUD */
        .gameHUD {
            position: fixed;
            top: 10px;
            width: 95%;
            max-width: 900px;
            display: none;
            justify-content: space-between;
            background: rgba(15, 23, 42, 0.85);
            padding: 15px 20px;
            border-radius: 15px;
            border: 1px solid rgba(100, 116, 139, 0.3);
            backdrop-filter: blur(15px);
            z-index: 10;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            flex-wrap: wrap;
            gap: 15px;
        }

        .hudSection {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            min-width: 70px;
            flex: 1;
        }

        .hudIcon {
            font-size: clamp(1rem, 4vw, 1.5rem);
            margin-bottom: 5px;
            background: linear-gradient(90deg, #48dbfb, #3b82f6);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hudLabel {
            font-size: clamp(0.6rem, 2.5vw, 0.8rem);
            color: #94a3b8;
            margin-bottom: 3px;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .hudValue {
            font-size: clamp(1.2rem, 5vw, 2rem);
            font-weight: 800;
            color: #fff;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        #speedValue {
            background: linear-gradient(90deg, #feca57, #f59e0b);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        #levelValue {
            background: linear-gradient(90deg, #48dbfb, #0ea5e9);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        #scoreValue {
            background: linear-gradient(90deg, #ff9ff3, #d946ef);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .fuel-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 100px;
        }

        #fuelBarContainer {
            width: clamp(100px, 30vw, 180px);
            height: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid rgba(100, 116, 139, 0.5);
            margin-top: 5px;
            position: relative;
        }

        #fuelBar {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #22c55e);
            width: 100%;
            transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        #fuelBar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 50%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
        }

        /* Car Info Panel - Hidden on mobile */
        .carInfo {
            position: fixed;
            bottom: 150px;
            left: 20px;
            background: rgba(15, 23, 42, 0.9);
            padding: 15px;
            border-radius: 12px;
            border-left: 5px solid #3b82f6;
            font-size: 0.8rem;
            max-width: 220px;
            display: none;
            backdrop-filter: blur(10px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(100, 116, 139, 0.3);
        }

        .carInfo h3 {
            color: #f1f5f9;
            margin-bottom: 8px;
            font-size: 1rem;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .carSpec {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            color: #cbd5e1;
        }

        .carSpec span:last-child {
            color: #feca57;
            font-weight: 600;
        }

        /* Controls */
        .controlsContainer {
            position: fixed;
            bottom: 20px;
            width: 100%;
            max-width: 700px;
            display: none;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            z-index: 20;
            touch-action: manipulation;
        }

        .pedalButton {
            background: linear-gradient(180deg, #334155, #1e293b);
            width: clamp(60px, 18vw, 90px);
            height: clamp(60px, 18vw, 90px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(1.5rem, 6vw, 2.2rem);
            color: white;
            box-shadow: 
                0 8px 0 #0f172a,
                0 15px 25px rgba(0, 0, 0, 0.6);
            cursor: pointer;
            user-select: none;
            transition: all 0.15s;
            border: 3px solid #475569;
            position: relative;
            overflow: hidden;
            touch-action: manipulation;
        }

        .pedalButton::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, transparent 30%, rgba(255, 255, 255, 0.1) 100%);
        }

        .pedalButton:active {
            transform: translateY(8px);
            box-shadow: 0 0 0 #0f172a, 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        #brakePedal {
            background: linear-gradient(180deg, #ef4444, #dc2626);
            border-color: #b91c1c;
        }

        #gasPedal {
            background: linear-gradient(180deg, #10b981, #059669);
            border-color: #065f46;
        }

        .arrowButtons {
            display: flex;
            gap: clamp(15px, 6vw, 25px);
        }

        .arrowButton {
            background: rgba(255, 255, 255, 0.1);
            width: clamp(55px, 16vw, 80px);
            height: clamp(55px, 16vw, 80px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: clamp(1.8rem, 7vw, 2.5rem);
            color: white;
            cursor: pointer;
            user-select: none;
            transition: all 0.2s;
            border: 2px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            touch-action: manipulation;
        }

        .arrowButton:active {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(0.92);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
        }

        /* Notifications */
        .levelUpNotification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(15, 23, 42, 0.95);
            padding: 30px 40px;
            border-radius: 15px;
            border: 2px solid;
            border-image: linear-gradient(45deg, #48dbfb, #8b5cf6) 1;
            text-align: center;
            z-index: 50;
            display: none;
            backdrop-filter: blur(20px);
            box-shadow: 
                0 20px 60px rgba(72, 219, 251, 0.3),
                inset 0 0 0 1px rgba(255, 255, 255, 0.1);
            animation: notificationPop 0.5s forwards;
            max-width: 90%;
        }

        @keyframes notificationPop {
            0% { transform: translate(-50%, -50%) scale(0); }
            70% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        .levelUpNotification h2 {
            font-size: clamp(1.5rem, 6vw, 3rem);
            margin-bottom: 10px;
            background: linear-gradient(45deg, #48dbfb, #8b5cf6);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .levelUpNotification p {
            color: #e2e8f0;
            font-size: clamp(1rem, 4vw, 1.3rem);
            margin-bottom: 10px;
        }

        /* Game Over Screen */
        .gameOverScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(15, 23, 42, 0.95) 0%, rgba(0, 0, 0, 0.98) 100%);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            backdrop-filter: blur(10px);
            padding: 20px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .gameOverScreen h2 {
            font-size: clamp(2rem, 10vw, 4rem);
            margin-bottom: 15px;
            background: linear-gradient(90deg, #ef4444, #f97316);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 5px 20px rgba(239, 68, 68, 0.3);
        }

        .gameOverScreen p {
            font-size: clamp(1.2rem, 5vw, 1.8rem);
            margin-bottom: 15px;
            color: #e2e8f0;
        }

        .finalStats {
            background: rgba(30, 41, 59, 0.7);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border: 1px solid rgba(100, 116, 139, 0.3);
            width: 90%;
            max-width: 400px;
        }

        .statRow {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(100, 116, 139, 0.2);
            font-size: clamp(0.9rem, 3vw, 1.1rem);
        }

        .statRow:last-child {
            border-bottom: none;
        }

        /* Performance Gauge - Hidden on mobile */
        .performance-gauge {
            position: fixed;
            bottom: 180px;
            right: 10px;
            width: clamp(150px, 30vw, 200px);
            background: rgba(15, 23, 42, 0.9);
            padding: 12px;
            border-radius: 12px;
            display: none;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 116, 139, 0.3);
        }

        .performance-gauge h4 {
            font-size: 0.9rem;
            margin-bottom: 8px;
        }

        .gauge-meter {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin: 8px 0;
        }

        .gauge-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #f59e0b, #ef4444);
            border-radius: 3px;
            width: 70%;
        }

        /* Instructions for Mobile */
        .mobile-instructions {
            display: none;
            position: fixed;
            bottom: 200px;
            width: 100%;
            text-align: center;
            color: #94a3b8;
            font-size: 0.8rem;
            padding: 0 20px;
            z-index: 5;
        }

        /* Landscape Mode Warning */
        .landscape-warning {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            text-align: center;
        }

        .landscape-warning i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #feca57;
        }

        .landscape-warning p {
            font-size: 1.2rem;
            margin-bottom: 10px;
            color: #fff;
        }

        /* Media Queries */
        @media (max-width: 768px) {
            .gameHUD {
                top: 5px;
                padding: 10px 15px;
                gap: 10px;
            }
            
            .hudSection {
                min-width: 60px;
            }
            
            .carInfo {
                display: none !important;
            }
            
            .performance-gauge {
                display: none !important;
            }
            
            .mobile-instructions {
                display: block;
            }
            
            .controlsContainer {
                bottom: 10px;
                padding: 0 15px;
            }
            
            .arrowButton, .pedalButton {
                width: 70px;
                height: 70px;
            }
            
            .finalStats {
                padding: 15px;
            }
        }

        @media (max-width: 480px) {
            .gameHUD {
                flex-wrap: nowrap;
                overflow-x: auto;
                padding: 8px 10px;
                justify-content: space-around;
            }
            
            .hudSection {
                min-width: 50px;
            }
            
            .hudValue {
                font-size: 1rem;
            }
            
            .fuel-container {
                min-width: 80px;
            }
            
            #fuelBarContainer {
                width: 80px;
            }
            
            .arrowButton, .pedalButton {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }
            
            .arrowButtons {
                gap: 10px;
            }
            
            .gameButton {
                min-width: 150px;
                padding: 12px 25px;
            }
        }

        @media (orientation: landscape) and (max-height: 500px) {
            .landscape-warning {
                display: flex;
            }
            
            #gameStartScreen,
            .game-container,
            .gameOverScreen {
                display: none !important;
            }
        }

        @media (min-width: 1024px) {
            .game-container {
                max-height: 700px;
            }
        }
    </style>
</head>
<body>
    <!-- Background Effects -->
    <div class="galaxy-bg"></div>
    <div class="stars"></div>

    <!-- Landscape Warning -->
    <div class="landscape-warning">
        <i class="fas fa-rotate"></i>
        <p>Please rotate your device to portrait mode</p>
        <p style="font-size: 1rem; color: #94a3b8;">For the best gaming experience</p>
    </div>

    <!-- Start Screen -->
    <div id="gameStartScreen">
        <div class="game-brand">
            <div class="brand-logo">üèéÔ∏è</div>
            <div class="brand-title">VelocityX Pro</div>
            <div class="brand-subtitle">Ultimate Racing Experience</div>
        </div>

        <div class="creator-badge">
            <span><i class="fas fa-code"></i> Crafted by Shreyash Vaibhav Patil</span>
        </div>

        <div class="game-description">
            Experience the next generation of racing! Dodge dynamic traffic, 
            manage advanced vehicle systems, and climb through challenging levels 
            in this hyper-realistic racing simulation.
        </div>

        <div class="game-features">
            <div class="feature">
                <i class="fas fa-tachometer-alt"></i>
                <h4>Real Physics</h4>
                <p>Advanced vehicle dynamics</p>
            </div>
            <div class="feature">
                <i class="fas fa-layer-group"></i>
                <h4>3D Effects</h4>
                <p>Immersive visual experience</p>
            </div>
            <div class="feature">
                <i class="fas fa-traffic-light"></i>
                <h4>Smart AI</h4>
                <p>Dynamic traffic system</p>
            </div>
            <div class="feature">
                <i class="fas fa-chart-line"></i>
                <h4>Progression</h4>
                <p>Level-based challenges</p>
            </div>
        </div>

        <button class="gameButton" onclick="startGame()">
            <i class="fas fa-play-circle"></i> IGNITE ENGINE
        </button>

        <div style="margin-top: 30px; color: #64748b; font-size: 0.8rem; padding: 0 15px;">
            <p><i class="fas fa-gamepad"></i> Use ARROWS to steer ‚Ä¢ GAS/BRAKE pedals ‚Ä¢ Dodge traffic for score</p>
            <p style="margin-top: 10px; font-size: 0.7rem;"><i class="fas fa-mobile-alt"></i> Optimized for all devices</p>
        </div>
    </div>

    <!-- Game Container -->
    <div class="game-container">
        <canvas id="gameCanvas"></canvas>
    </div>

    <!-- Game HUD -->
    <div class="gameHUD" id="gameHUD">
        <div class="hudSection">
            <div class="hudIcon"><i class="fas fa-tachometer-alt"></i></div>
            <div class="hudLabel">Velocity</div>
            <div class="hudValue"><span id="speedValue">0</span> KM/H</div>
        </div>
        <div class="hudSection">
            <div class="hudIcon"><i class="fas fa-flag-checkered"></i></div>
            <div class="hudLabel">Stage</div>
            <div class="hudValue"><span id="levelValue">1</span></div>
        </div>
        <div class="hudSection">
            <div class="hudIcon"><i class="fas fa-trophy"></i></div>
            <div class="hudLabel">Score</div>
            <div class="hudValue"><span id="scoreValue">0</span></div>
        </div>
        <div class="hudSection fuel-container">
            <div class="hudIcon"><i class="fas fa-gas-pump"></i></div>
            <div class="hudLabel">Nitro Fuel</div>
            <div class="hudValue" id="fuelValue">100%</div>
            <div id="fuelBarContainer">
                <div id="fuelBar"></div>
            </div>
        </div>
    </div>

    <!-- Car Info Panel -->
    <div class="carInfo" id="carInfo">
        <h3><i class="fas fa-car"></i> VELOCITY X-9000</h3>
        <div class="carSpec">
            <span>Engine:</span>
            <span>V12 TWIN-TURBO</span>
        </div>
        <div class="carSpec">
            <span>Power:</span>
            <span>950 HP</span>
        </div>
        <div class="carSpec">
            <span>Lane:</span>
            <span id="currentLane">3</span>/5
        </div>
        <div class="carSpec">
            <span>Gear:</span>
            <span id="currentGear">D</span>
        </div>
        <div class="carSpec">
            <span>Mode:</span>
            <span id="driveMode">SPORT</span>
        </div>
    </div>

    <!-- Performance Gauge -->
    <div class="performance-gauge" id="performanceGauge">
        <h4><i class="fas fa-chart-bar"></i> Performance</h4>
        <div>Throttle: <span id="throttleValue">0%</span></div>
        <div class="gauge-meter">
            <div class="gauge-fill" id="throttleGauge"></div>
        </div>
        <div>RPM: <span id="rpmValue">0</span></div>
        <div class="gauge-meter">
            <div class="gauge-fill" id="rpmGauge"></div>
        </div>
    </div>

    <!-- Mobile Instructions -->
    <div class="mobile-instructions" id="mobileInstructions">
        <p><i class="fas fa-hand-point-up"></i> Tap and hold pedals to accelerate/brake</p>
    </div>

    <!-- Level Up Notification -->
    <div class="levelUpNotification" id="levelUpNotification">
        <h2><i class="fas fa-rocket"></i> STAGE CLEARED!</h2>
        <p>Advanced to <span id="newLevelText">Stage 2</span></p>
        <p style="font-size: 0.9rem; margin-top: 15px; color: #feca57;">
            <i class="fas fa-exclamation-triangle"></i> Increased difficulty activated
        </p>
        <div style="margin-top: 20px; padding: 12px; background: rgba(30, 41, 59, 0.5); border-radius: 8px;">
            <p style="font-size: 0.8rem; color: #94a3b8;">Unlocked: Enhanced AI Traffic</p>
        </div>
    </div>

    <!-- Game Over Screen -->
    <div class="gameOverScreen" id="gameOverScreen">
        <h2><i class="fas fa-flag-checkered"></i> RACE COMPLETE</h2>
        <p>Your Performance Summary</p>
        
        <div class="finalStats">
            <div class="statRow">
                <span>Final Score:</span>
                <span id="finalScore" style="color: #feca57;">0</span>
            </div>
            <div class="statRow">
                <span>Stage Reached:</span>
                <span id="finalLevel" style="color: #48dbfb;">1</span>
            </div>
            <div class="statRow">
                <span>Cars Dodged:</span>
                <span id="finalCars" style="color: #ff9ff3;">0</span>
            </div>
            <div class="statRow">
                <span>Top Speed:</span>
                <span id="finalSpeed" style="color: #feca57;">0 KM/H</span>
            </div>
            <div class="statRow">
                <span>Game Time:</span>
                <span id="finalTime" style="color: #10b981;">00:00</span>
            </div>
        </div>

        <button class="gameButton" onclick="location.reload()">
            <i class="fas fa-redo"></i> NEW RACE
        </button>
        
        <div style="margin-top: 25px; color: #64748b; font-size: 0.8rem;">
            <p><i class="fas fa-code"></i> VelocityX Pro Racing Engine ‚Ä¢ Developed by Shreyash Vaibhav Patil</p>
        </div>
    </div>

    <!-- Controls -->
    <div class="controlsContainer" id="controlsContainer">
        <div class="pedalButton" id="brakePedal" 
             ontouchstart="applyBrake()" ontouchend="releaseBrake()" 
             onmousedown="applyBrake()" onmouseup="releaseBrake()">
            <i class="fas fa-hand-paper"></i>
        </div>
        
        <div class="arrowButtons">
            <div class="arrowButton" 
                 ontouchstart="moveLeft()" ontouchend="clearMove()" 
                 onmousedown="moveLeft()" onmouseup="clearMove()">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="arrowButton" 
                 ontouchstart="moveRight()" ontouchend="clearMove()" 
                 onmousedown="moveRight()" onmouseup="clearMove()">
                <i class="fas fa-arrow-right"></i>
            </div>
        </div>
        
        <div class="pedalButton" id="gasPedal" 
             ontouchstart="applyGas()" ontouchend="releaseGas()" 
             onmousedown="applyGas()" onmouseup="releaseGas()">
            <i class="fas fa-bolt"></i>
        </div>
    </div>

    <!-- Audio -->
    <audio id="engineSound" loop>
        <source src="https://assets.mixkit.co/music/preview/mixkit-racing-game-988.mp3" type="audio/mpeg">
    </audio>
    <audio id="collisionSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-car-collision-debris-1562.mp3" type="audio/mpeg">
    </audio>
    <audio id="fuelSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>
    <audio id="levelUpSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" type="audio/mpeg">
    </audio>
    <audio id="gearShiftSound">
        <source src="https://assets.mixkit.co/sfx/preview/mixkit-gear-shift-in-car-1136.mp3" type="audio/mpeg">
    </audio>

    <script>
        // Enhanced Game Variables
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let gameRunning = false;
        let gameLoopId;
        let gameStartTime;
        let gear = 1;
        let rpm = 0;
        
        // Canvas responsive setup
        function resizeCanvas() {
            const container = document.querySelector('.game-container');
            const isMobile = window.innerWidth <= 768;
            const isPortrait = window.innerHeight > window.innerWidth;
            
            if (isMobile && isPortrait) {
                // Mobile portrait - taller canvas
                canvas.width = Math.min(container.clientWidth - 40, 400);
                canvas.height = Math.min(window.innerHeight * 0.7, 650);
            } else if (isMobile && !isPortrait) {
                // Mobile landscape - wider canvas
                canvas.width = Math.min(container.clientWidth - 40, 600);
                canvas.height = Math.min(window.innerHeight * 0.8, 350);
            } else if (window.innerWidth <= 1024) {
                // Tablet
                canvas.width = Math.min(container.clientWidth - 40, 700);
                canvas.height = Math.min(window.innerHeight * 0.75, 500);
            } else {
                // Desktop
                canvas.width = Math.min(container.clientWidth - 40, 800);
                canvas.height = Math.min(window.innerHeight * 0.8, 600);
            }
            
            // Recalculate lane positions based on new canvas width
            recalculateLanes();
        }
        
        // 5 Lanes Setup
        function recalculateLanes() {
            const roadWidth = canvas.width - 100; // 50px margin on each side
            lanePositions.length = 0;
            for (let i = 0; i < 5; i++) {
                lanePositions.push(50 + (i * roadWidth / 4));
            }
        }
        
        // Enhanced Player Car
        const playerCar = {
            x: 0,
            y: 0,
            width: 40,
            height: 80,
            speed: 5,
            maxSpeed: 25,
            acceleration: 0.25,
            deceleration: 0.15,
            lane: 3, // Start in middle lane
            fuel: 100,
            fuelConsumption: 0.025,
            score: 0,
            level: 1,
            carsPassed: 0,
            color: '#ef4444',
            topSpeed: 0,
            isBoosting: false,
            boostFuel: 100
        };
        
        // Enhanced Traffic and Items
        let trafficCars = [];
        let fuelCans = [];
        let roadY = 0;
        let particles = [];
        
        // Controls State
        let keys = {
            left: false,
            right: false,
            gas: false,
            brake: false,
            boost: false
        };
        
        // Lane Positions (will be calculated in resizeCanvas)
        let lanePositions = [];
        
        // Start Game Function
        function startGame() {
            resizeCanvas();
            
            // Position player car in middle lane
            playerCar.x = lanePositions[2] - playerCar.width / 2;
            playerCar.y = canvas.height - playerCar.height - 30;
            
            document.getElementById('gameStartScreen').style.display = 'none';
            document.querySelector('.game-container').style.display = 'block';
            document.getElementById('gameHUD').style.display = 'flex';
            document.getElementById('controlsContainer').style.display = 'flex';
            document.getElementById('mobileInstructions').style.display = 'block';
            
            // Show car info and performance gauge only on larger screens
            if (window.innerWidth > 768) {
                document.getElementById('carInfo').style.display = 'block';
                document.getElementById('performanceGauge').style.display = 'block';
            }
            
            // Start engine sound
            const engineSound = document.getElementById('engineSound');
            engineSound.volume = 0.5;
            engineSound.play().catch(e => console.log("Audio:", e));
            
            gameRunning = true;
            gameStartTime = Date.now();
            
            // Enhanced game loops
            setInterval(addTrafficCar, 1000 - (playerCar.level * 100));
            setInterval(addFuelCan, 7000);
            setInterval(updateFuel, 100);
            setInterval(updateGear, 500);
            
            // Start main game loop
            gameLoopId = requestAnimationFrame(gameLoop);
        }
        
        // Add Enhanced Traffic Car with collision avoidance
        function addTrafficCar() {
            if (!gameRunning || trafficCars.length > 15) return;
            
            // Choose a lane that doesn't have cars too close
            let safeLane;
            let attempts = 0;
            const maxAttempts = 10;
            
            do {
                safeLane = Math.floor(Math.random() * 5);
                attempts++;
                
                // Check if there's enough space in this lane
                const carsInLane = trafficCars.filter(car => car.lane === safeLane + 1);
                let hasSpace = true;
                
                for (const car of carsInLane) {
                    // If a car is too close to the top, don't add another one
                    if (car.y < 200) {
                        hasSpace = false;
                        break;
                    }
                }
                
                if (hasSpace || attempts >= maxAttempts) {
                    break;
                }
            } while (true);
            
            const carTypes = [
                { color: '#3b82f6', width: 40, height: 80, speed: 4 + playerCar.level * 0.7 },
                { color: '#10b981', width: 45, height: 90, speed: 3.5 + playerCar.level * 0.6 },
                { color: '#8b5cf6', width: 35, height: 75, speed: 5 + playerCar.level * 0.8 },
                { color: '#f59e0b', width: 50, height: 100, speed: 3 + playerCar.level * 0.5 }
            ];
            
            const type = carTypes[Math.floor(Math.random() * carTypes.length)];
            const isSpecial = Math.random() > 0.9;
            
            trafficCars.push({
                x: lanePositions[safeLane] - type.width / 2,
                y: -150,
                width: type.width,
                height: type.height,
                color: type.color,
                speed: type.speed,
                lane: safeLane + 1,
                isSpecial: isSpecial,
                specialColor: isSpecial ? '#f97316' : null,
                originalSpeed: type.speed
            });
        }
        
        // Add Enhanced Fuel Can
        function addFuelCan() {
            if (!gameRunning || playerCar.fuel > 80 || fuelCans.length > 3) return;
            
            const lane = Math.floor(Math.random() * 5) + 1;
            const isNitro = Math.random() > 0.7;
            
            fuelCans.push({
                x: lanePositions[lane - 1] - 15,
                y: -80,
                width: 30,
                height: 50,
                collected: false,
                type: isNitro ? 'nitro' : 'fuel',
                value: isNitro ? 50 : 30
            });
        }
        
        // Update Gear System
        function updateGear() {
            if (!gameRunning) return;
            
            const speed = playerCar.speed;
            let newGear = 1;
            
            if (speed > 20) newGear = 5;
            else if (speed > 15) newGear = 4;
            else if (speed > 10) newGear = 3;
            else if (speed > 5) newGear = 2;
            
            if (newGear !== gear) {
                gear = newGear;
                document.getElementById('currentGear').textContent = gear;
                document.getElementById('gearShiftSound').play().catch(e => console.log("Audio:", e));
            }
            
            // Update RPM
            rpm = Math.min(8000, Math.floor((playerCar.speed / playerCar.maxSpeed) * 8000));
            document.getElementById('rpmValue').textContent = rpm;
            document.getElementById('rpmGauge').style.width = (rpm / 8000 * 100) + '%';
            
            // Update throttle
            const throttle = keys.gas ? 100 : keys.brake ? 0 : 50;
            document.getElementById('throttleValue').textContent = throttle + '%';
            document.getElementById('throttleGauge').style.width = throttle + '%';
        }
        
        // Update Fuel System
        function updateFuel() {
            if (!gameRunning) return;
            
            let consumption = playerCar.fuelConsumption;
            if (keys.gas) consumption *= 1.8;
            if (playerCar.isBoosting) consumption *= 2.5;
            
            playerCar.fuel -= consumption;
            playerCar.fuel = Math.max(0, Math.min(100, playerCar.fuel));
            
            // Update displays
            document.getElementById('fuelValue').textContent = Math.floor(playerCar.fuel) + '%';
            document.getElementById('fuelBar').style.width = playerCar.fuel + '%';
            
            // Update fuel bar color
            const fuelBar = document.getElementById('fuelBar');
            if (playerCar.fuel > 60) {
                fuelBar.style.background = 'linear-gradient(90deg, #10b981, #22c55e)';
            } else if (playerCar.fuel > 30) {
                fuelBar.style.background = 'linear-gradient(90deg, #f59e0b, #f97316)';
            } else {
                fuelBar.style.background = 'linear-gradient(90deg, #ef4444, #dc2626)';
                if (playerCar.fuel < 10 && Math.random() > 0.7) {
                    createParticles(playerCar.x + 20, playerCar.y + playerCar.height, 3);
                }
            }
            
            // Check for game over
            if (playerCar.fuel <= 0 && playerCar.speed < 3) {
                gameOver("Fuel Depleted");
            }
        }
        
        // Create Particles for Effects
        function createParticles(x, y, count) {
            for (let i = 0; i < count; i++) {
                particles.push({
                    x: x,
                    y: y,
                    size: Math.random() * 4 + 2,
                    speedX: (Math.random() - 0.5) * 4,
                    speedY: Math.random() * 3 + 2,
                    color: '#f59e0b',
                    life: 30
                });
            }
        }
        
        // Draw Enhanced Road with 5 lanes
        function drawRoad() {
            // Road surface with gradient
            const roadGradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            roadGradient.addColorStop(0, '#1e293b');
            roadGradient.addColorStop(0.5, '#334155');
            roadGradient.addColorStop(1, '#0f172a');
            ctx.fillStyle = roadGradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // 3D Road markings with perspective
            ctx.strokeStyle = '#f1f5f9';
            ctx.lineWidth = 3;
            ctx.setLineDash([30, 25]);
            
            for (let i = 0; i < 5; i++) {
                const y = (roadY + i * 60) % 300;
                const scale = 1 - y / 300;
                const width = 15 * scale;
                
                ctx.beginPath();
                ctx.moveTo(canvas.width/2 - width/2, y);
                ctx.lineTo(canvas.width/2 + width/2, y);
                ctx.stroke();
            }
            
            // 5 Lane markings
            ctx.setLineDash([]);
            ctx.strokeStyle = '#475569';
            ctx.lineWidth = 2;
            
            const laneWidth = (canvas.width - 100) / 4;
            for (let i = 1; i <= 4; i++) {
                ctx.beginPath();
                ctx.moveTo(50 + laneWidth * i, 0);
                ctx.lineTo(50 + laneWidth * i, canvas.height);
                ctx.stroke();
            }
            
            // Road shoulder
            ctx.fillStyle = '#1e293b';
            ctx.fillRect(0, 0, 50, canvas.height);
            ctx.fillRect(canvas.width - 50, 0, 50, canvas.height);
            
            // Animate road
            roadY += playerCar.speed;
            if (roadY > 60) roadY = 0;
        }
        
        // Draw Enhanced Player Car with 3D Effects
        function drawPlayerCar() {
            // Car body with gradient
            const carGradient = ctx.createLinearGradient(
                playerCar.x, playerCar.y,
                playerCar.x, playerCar.y + playerCar.height
            );
            carGradient.addColorStop(0, playerCar.color);
            carGradient.addColorStop(1, '#b91c1c');
            
            ctx.fillStyle = carGradient;
            ctx.fillRect(playerCar.x, playerCar.y, playerCar.width, playerCar.height);
            
            // 3D effect - highlights and shadows
            ctx.fillStyle = 'rgba(255, 255, 255, 0.2)';
            ctx.fillRect(playerCar.x + 4, playerCar.y + 4, playerCar.width - 8, 12);
            
            ctx.fillStyle = 'rgba(0, 0, 0, 0.3)';
            ctx.fillRect(playerCar.x, playerCar.y + playerCar.height - 4, playerCar.width, 4);
            
            // Windows
            ctx.fillStyle = '#1e293b';
            ctx.fillRect(playerCar.x + 6, playerCar.y + 10, playerCar.width - 12, 8);
            
            // Wheels
            ctx.fillStyle = '#0f172a';
            ctx.fillRect(playerCar.x + 4, playerCar.y + playerCar.height - 12, 10, 10);
            ctx.fillRect(playerCar.x + playerCar.width - 14, playerCar.y + playerCar.height - 12, 10, 10);
            
            // Headlights with glow effect
            ctx.fillStyle = '#f1f5f9';
            ctx.beginPath();
            ctx.arc(playerCar.x + 6, playerCar.y + 6, 3, 0, Math.PI * 2);
            ctx.arc(playerCar.x + playerCar.width - 6, playerCar.y + 6, 3, 0, Math.PI * 2);
            ctx.fill();
            
            // Glow effect
            ctx.shadowColor = '#f1f5f9';
            ctx.shadowBlur = 8;
            ctx.fill();
            ctx.shadowBlur = 0;
            
            // Branding
            ctx.fillStyle = '#f1f5f9';
            ctx.font = 'bold 10px Arial';
            ctx.fillText('VELOCITY', playerCar.x + 10, playerCar.y + 25);
            ctx.font = 'bold 8px Arial';
            ctx.fillText('X-9000', playerCar.x + 15, playerCar.y + 35);
            
            // Boost effect
            if (playerCar.isBoosting) {
                ctx.fillStyle = '#06b6d4';
                ctx.fillRect(playerCar.x + 12, playerCar.y - 8, playerCar.width - 24, 8);
            }
        }
        
        // Draw Enhanced Traffic Cars with collision avoidance
        function drawTrafficCars() {
            // Update traffic car positions with collision avoidance
            trafficCars.forEach(car => {
                // Check for collisions with other traffic cars in the same lane
                const sameLaneCars = trafficCars.filter(otherCar => 
                    otherCar !== car && 
                    otherCar.lane === car.lane
                );
                
                let minDistance = 150; // Minimum safe distance
                let shouldSlowDown = false;
                
                for (const otherCar of sameLaneCars) {
                    const distance = otherCar.y - (car.y + car.height);
                    if (distance > 0 && distance < minDistance) {
                        shouldSlowDown = true;
                        minDistance = distance;
                    }
                }
                
                // Adjust speed to avoid collisions
                if (shouldSlowDown && minDistance < 100) {
                    car.speed = Math.max(2, car.originalSpeed * 0.5);
                } else {
                    car.speed = car.originalSpeed;
                }
                
                car.y += car.speed;
                
                // Special car effect
                if (car.isSpecial) {
                    ctx.fillStyle = car.specialColor;
                    ctx.shadowColor = car.specialColor;
                    ctx.shadowBlur = 12;
                } else {
                    ctx.fillStyle = car.color;
                }
                
                ctx.fillRect(car.x, car.y, car.width, car.height);
                ctx.shadowBlur = 0;
                
                // Car details
                ctx.fillStyle = '#1e293b';
                ctx.fillRect(car.x + 4, car.y + 8, car.width - 8, 12);
                ctx.fillStyle = '#0f172a';
                ctx.fillRect(car.x + 6, car.y + car.height - 12, 8, 8);
                ctx.fillRect(car.x + car.width - 14, car.y + car.height - 12, 8, 8);
                
                // Check if car passed
                if (car.y > canvas.height) {
                    playerCar.carsPassed++;
                    playerCar.score += car.isSpecial ? 25 : 10;
                    
                    if (playerCar.carsPassed >= 50 && playerCar.level === 1) {
                        levelUp();
                    }
                    
                    trafficCars = trafficCars.filter(c => c !== car);
                }
                
                // Check collision with player car
                if (detectCollision(playerCar, car)) {
                    document.getElementById('collisionSound').play().catch(e => console.log("Audio:", e));
                    createParticles(car.x + car.width/2, car.y + car.height/2, 20);
                    gameOver("Collision!");
                }
            });
            
            trafficCars = trafficCars.filter(car => car.y < canvas.height + 100);
        }
        
        // Draw Enhanced Fuel Cans
        function drawFuelCans() {
            fuelCans.forEach(can => {
                can.y += playerCar.speed * 0.7;
                
                // Draw can based on type
                if (can.type === 'nitro') {
                    ctx.fillStyle = '#06b6d4';
                    ctx.shadowColor = '#06b6d4';
                    ctx.shadowBlur = 8;
                } else {
                    ctx.fillStyle = '#f59e0b';
                }
                
                ctx.fillRect(can.x, can.y, can.width, can.height);
                ctx.shadowBlur = 0;
                
                // Can details
                ctx.fillStyle = can.type === 'nitro' ? '#0c4a6e' : '#b45309';
                ctx.fillRect(can.x + 4, can.y + 4, can.width - 8, 10);
                ctx.fillRect(can.x + 6, can.y + 20, can.width - 12, 16);
                
                // Symbol
                ctx.fillStyle = '#ffffff';
                ctx.font = 'bold 12px Arial';
                ctx.fillText(can.type === 'nitro' ? '‚ö°' : '‚õΩ', can.x + 9, can.y + 35);
                
                // Check collection
                if (!can.collected && detectCollision(playerCar, can)) {
                    can.collected = true;
                    playerCar.fuel = Math.min(100, playerCar.fuel + can.value);
                    playerCar.score += can.type === 'nitro' ? 100 : 50;
                    
                    document.getElementById('fuelSound').play().catch(e => console.log("Audio:", e));
                    createParticles(can.x + can.width/2, can.y + can.height/2, 12);
                    fuelCans = fuelCans.filter(c => c !== can);
                }
                
                if (can.y > canvas.height) {
                    fuelCans = fuelCans.filter(c => c !== can);
                }
            });
        }
        
        // Draw Particles
        function drawParticles() {
            particles.forEach((particle, index) => {
                particle.x += particle.speedX;
                particle.y += particle.speedY;
                particle.life--;
                
                ctx.fillStyle = particle.color;
                ctx.globalAlpha = particle.life / 30;
                ctx.beginPath();
                ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1;
                
                if (particle.life <= 0) {
                    particles.splice(index, 1);
                }
            });
        }
        
        // Collision Detection
        function detectCollision(obj1, obj2) {
            return obj1.x < obj2.x + obj2.width &&
                   obj1.x + obj1.width > obj2.x &&
                   obj1.y < obj2.y + obj2.height &&
                   obj1.y + obj1.height > obj2.y;
        }
        
        // Level Up Function
        function levelUp() {
            playerCar.level = 2;
            playerCar.maxSpeed = 30;
            
            // Update displays
            document.getElementById('levelValue').textContent = playerCar.level;
            document.getElementById('newLevelText').textContent = 'Stage ' + playerCar.level;
            document.getElementById('driveMode').textContent = 'PRO';
            
            // Show notification
            const notification = document.getElementById('levelUpNotification');
            notification.style.display = 'block';
            
            // Play sound
            document.getElementById('levelUpSound').play().catch(e => console.log("Audio:", e));
            
            // Hide notification
            setTimeout(() => {
                notification.style.display = 'none';
            }, 4000);
        }
        
        // Game Over Function
        function gameOver(reason) {
            gameRunning = false;
            
            // Stop engine sound
            document.getElementById('engineSound').pause();
            
            // Calculate game time
            const gameTime = Date.now() - gameStartTime;
            const minutes = Math.floor(gameTime / 60000);
            const seconds = Math.floor((gameTime % 60000) / 1000);
            
            // Update final stats
            document.getElementById('finalScore').textContent = playerCar.score;
            document.getElementById('finalLevel').textContent = playerCar.level;
            document.getElementById('finalCars').textContent = playerCar.carsPassed;
            document.getElementById('finalSpeed').textContent = Math.floor(playerCar.topSpeed * 15) + ' KM/H';
            document.getElementById('finalTime').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Show game over screen
            document.getElementById('gameOverScreen').style.display = 'flex';
            
            // Hide other elements
            document.getElementById('controlsContainer').style.display = 'none';
            document.getElementById('mobileInstructions').style.display = 'none';
            
            // Cancel game loop
            cancelAnimationFrame(gameLoopId);
        }
        
        // Update HUD
        function updateHUD() {
            const speedKmh = Math.floor(playerCar.speed * 15);
            playerCar.topSpeed = Math.max(playerCar.topSpeed, playerCar.speed);
            
            document.getElementById('speedValue').textContent = speedKmh;
            document.getElementById('scoreValue').textContent = playerCar.score;
            document.getElementById('levelValue').textContent = playerCar.level;
            document.getElementById('currentLane').textContent = playerCar.lane;
        }
        
        // Control Functions
        function moveLeft() {
            keys.left = true;
        }
        
        function moveRight() {
            keys.right = true;
        }
        
        function clearMove() {
            keys.left = false;
            keys.right = false;
        }
        
        function applyGas() {
            keys.gas = true;
            const pedal = document.getElementById('gasPedal');
            pedal.style.transform = 'translateY(8px)';
            pedal.style.boxShadow = '0 0 0 #0f172a, 0 5px 15px rgba(0, 0, 0, 0.5)';
        }
        
        function releaseGas() {
            keys.gas = false;
            const pedal = document.getElementById('gasPedal');
            pedal.style.transform = '';
            pedal.style.boxShadow = '0 8px 0 #0f172a, 0 15px 25px rgba(0, 0, 0, 0.6)';
        }
        
        function applyBrake() {
            keys.brake = true;
            const pedal = document.getElementById('brakePedal');
            pedal.style.transform = 'translateY(8px)';
            pedal.style.boxShadow = '0 0 0 #0f172a, 0 5px 15px rgba(0, 0, 0, 0.5)';
        }
        
        function releaseBrake() {
            keys.brake = false;
            const pedal = document.getElementById('brakePedal');
            pedal.style.transform = '';
            pedal.style.boxShadow = '0 8px 0 #0f172a, 0 15px 25px rgba(0, 0, 0, 0.6)';
        }
        
        // Keyboard Controls
        document.addEventListener('keydown', (e) => {
            if (!gameRunning) return;
            
            switch(e.key.toLowerCase()) {
                case 'arrowleft':
                case 'a':
                    keys.left = true;
                    break;
                case 'arrowright':
                case 'd':
                    keys.right = true;
                    break;
                case 'arrowup':
                case 'w':
                    keys.gas = true;
                    break;
                case 'arrowdown':
                case 's':
                    keys.brake = true;
                    break;
                case ' ':
                    keys.boost = true;
                    playerCar.isBoosting = true;
                    break;
            }
        });
        
        document.addEventListener('keyup', (e) => {
            switch(e.key.toLowerCase()) {
                case 'arrowleft':
                case 'a':
                    keys.left = false;
                    break;
                case 'arrowright':
                case 'd':
                    keys.right = false;
                    break;
                case 'arrowup':
                case 'w':
                    keys.gas = false;
                    break;
                case 'arrowdown':
                case 's':
                    keys.brake = false;
                    break;
                case ' ':
                    keys.boost = false;
                    playerCar.isBoosting = false;
                    break;
            }
        });
        
        // Touch device optimization
        document.addEventListener('touchstart', (e) => {
            if (e.target.tagName === 'BUTTON' || e.target.closest('button')) {
                return;
            }
            e.preventDefault();
        }, { passive: false });
        
        // Prevent context menu on long press
        document.addEventListener('contextmenu', (e) => {
            if (gameRunning) {
                e.preventDefault();
            }
        });
        
        // Main Game Loop
        function gameLoop() {
            if (!gameRunning) return;
            
            // Apply controls for lane changing
            if (keys.left && playerCar.lane > 1) {
                playerCar.lane--;
                playerCar.x = lanePositions[playerCar.lane - 1] - playerCar.width / 2;
            }
            
            if (keys.right && playerCar.lane < 5) {
                playerCar.lane++;
                playerCar.x = lanePositions[playerCar.lane - 1] - playerCar.width / 2;
            }
            
            // Keep car within bounds
            playerCar.x = Math.max(50, Math.min(canvas.width - playerCar.width - 50, playerCar.x));
            
            // Apply physics
            if (keys.gas && playerCar.fuel > 0) {
                const acceleration = playerCar.isBoosting ? 
                    playerCar.acceleration * 1.5 : playerCar.acceleration;
                playerCar.speed = Math.min(playerCar.maxSpeed, playerCar.speed + acceleration);
            } else {
                playerCar.speed = Math.max(3, playerCar.speed - playerCar.deceleration);
            }
            
            if (keys.brake) {
                playerCar.speed = Math.max(2, playerCar.speed - playerCar.acceleration * 2.5);
            }
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw game elements
            drawRoad();
            drawTrafficCars();
            drawFuelCans();
            drawParticles();
            drawPlayerCar();
            
            // Update displays
            updateHUD();
            
            // Continue game loop
            gameLoopId = requestAnimationFrame(gameLoop);
        }
        
        // Handle window resize
        window.addEventListener('resize', () => {
            if (gameRunning) {
                resizeCanvas();
                // Reposition player car based on new lane positions
                playerCar.x = lanePositions[playerCar.lane - 1] - playerCar.width / 2;
                playerCar.y = canvas.height - playerCar.height - 30;
            }
        });
        
        // Handle orientation change
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                if (gameRunning) {
                    resizeCanvas();
                    playerCar.x = lanePositions[playerCar.lane - 1] - playerCar.width / 2;
                    playerCar.y = canvas.height - playerCar.height - 30;
                }
            }, 100);
        });
        
        // Initialize
        updateHUD();
        resizeCanvas();
        
        // Disable rubber-band scrolling on iOS
        document.body.addEventListener('touchmove', function(e) {
            if (gameRunning) {
                e.preventDefault();
            }
        }, { passive: false });
    </script>
</body>
</html>